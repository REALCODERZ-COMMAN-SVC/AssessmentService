/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.realcoderz.assessmentservice.repository;

import com.realcoderz.assessmentservice.domain.StudentMaster;
import java.util.Date;
import java.util.List;
import java.util.Set;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.util.LinkedCaseInsensitiveMap;

/**
 *
 * @author Aman Bansal, Shubham Mishra ,Rohan
 */
public interface StudentMasterRepository extends JpaRepository<StudentMaster, Long> {

    @Query(" from StudentMaster sm where sm.student_id=:student_id")
    public StudentMaster findByStudentId(@Param("student_id") Long student_id);

    @Query(" from StudentMaster where student_id in :ids ")
    public Set<StudentMaster> findByIds(@Param("ids") List<Long> ids);

//    @Query(nativeQuery = true, value = "select distinct sm.student_id as student_id,sm.recruiter_email as recruiter_email,sm.follow_up as follow_up,sm.recruiter_followup_date as follow_up_date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId and sm.job_portal_id=:jobId and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by created_date desc")
//    @Query(nativeQuery = true,value = "select distinct sif.total_percentage1 as interview1_score,sif.total_percentage2 as interview2_score,sa.coding_percentage as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,sm.ai_score as ai_success_score ,sm.student_id as student_id,sm.recruiter_email as recruiter_email,sm.follow_up as follow_up,sm.recruiter_followup_date as follow_up_date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId and sm.job_portal_id=:jobId and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by created_date desc")
//    @Query(nativeQuery = true, value = "select distinct (select rcassessment_desc from rcassessment_creation where rcassessment_id=assessment_id) as assessment_name, sa.remarks as remarks,sa.correct_questions as correct_questions,sa.total_no_of_questions as total_questions,sm.profile_path as image_url ,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id,sm.recruiter_email as recruiter_email,sm.follow_up as follow_up,sm.recruiter_followup_date as follow_up_date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,concat(round(sa.total_percentage,2),'%') as ass_percent,concat(round(sa.coding_percentage,2)) as coding_percentage,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId and sm.job_portal_id=:jobId and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by created_date desc")
    @Query(nativeQuery = true, value = "select distinct (select rcassessment_desc from rcassessment_creation where rcassessment_id=assessment_id) as assessment_name,sm.email_id as email, sa.remarks as remarks,date_format(sv.created_time,\"%d-%m-%Y %H:%i:%s\") as start_time,date_format(sa.end_time,\"%d-%m-%Y %H:%i:%s\") as end_time,sa.correct_questions as correct_questions,sa.total_no_of_questions as total_questions,sm.profile_path as image_url ,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id,sm.recruiter_email as recruiter_email,sm.follow_up as follow_up,sm.recruiter_followup_date as follow_up_date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,concat(round(sa.total_percentage,2),'%') as ass_percent,concat(round(sa.coding_percentage,2)) as coding_percentage,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa,student_validate sv where sm.student_id=sa.student_id and sm.organization_id=:organizationId and sm.job_portal_id=:jobId and sv.id =(select sv.id from student_validate sv where sv.email=sm.email_id order by sv.id desc limit 0,1) and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by created_date desc")
    public Set<LinkedCaseInsensitiveMap> getStudentDetails(@Param("organizationId") Long organizationId, @Param("jobId") Long jobId);

//    @Query(nativeQuery = true, value = "select distinct sm.student_id as student_id,sm.follow_up as follow_up,sm.recruiter_email as recruiter_email,sm.recruiter_followup_date as follow_up_date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id =:organization_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by sm.student_id desc /*:pageable*/",
//            countQuery = "select count(distinct sm.student_id) From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id =:organization_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by sm.created_date desc"
//    )
    @Query(nativeQuery = true, value = "select distinct sm.student_id as student_id,sm.profile_path as image_url,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score , 2) as  ai_success_score,sm.follow_up as follow_up,sm.recruiter_email as recruiter_email,sm.recruiter_followup_date as follow_up_date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id =:organization_id and sm.job_portal_id=:job_portal_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by sm.student_id desc /*:pageable*/",
            countQuery = "select count(distinct sm.student_id) From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id =:organization_id and sm.job_portal_id =:job_portal_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by sm.created_date desc"
    )
    public Page<LinkedCaseInsensitiveMap> getAllStudentDetails(@Param("pageable") Pageable pageable, @Param("organization_id") Long organization_id, @Param("job_portal_id") Long jobPortalId);

//    @Query(nativeQuery = true, value = "select distinct sm.student_id as student_id,jp.job_portal_desc as job_portal_desc,jp.job_portal_title as job_portal_title,sm.profile_path as profilePath,u.image_url as image,sif.specialization as specialization, sm.first_name as first_name ,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2)) AS score_percent,sm.last_name as last_name ,sm.mobile_no as mobile_no ,sm.gender as gender ,sm.district as district,sm.dob as dob,sm.current_address as address,sm.email_id as email_id,sm.pincode as pincode ,sm.city as city,sm.state as states,sm.tenth_percentage as tenth_percentage, sm.twelveth_percentage as twelveth_percentage,sm.internship_nature as internship_nature,sm.stream as stream,sm.graduation_percentage as percentage ,sm.graduation_name as graduation_name,sm.graduation_year as graduation_year,sm.university_name as college_name ,sa.correct_questions as score,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.coding_percentage as coding_percent,sa.total_coding_score as coding_score,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2)) AS total_percentage ,sif.status as status,sif.interviewer_name as interviewer,sif.interviewer_name2 as interviewer2,sif.presentation_skills as presentation_skills,sif.presentation_skills2 as presentation_skills2,sif.coding_skills as coding_skills,sif.coding_skills2 as coding_skills2,sif.java_score as java_score,sif.java_score2 as java_score2,sif.oops_score as oops_score,sif.oops_score2 as oops_score2,sif.x_factor as x_factor,sif.x_factor2 as x_factor2,sif.other_tech as other_tech,sif.tech_name as tech_name,sif.other_tech2 as other_tech2,sif.total_score as total_score,sif.total_score2 as total_score2,sif.feedback1 as feedback1,sif.feedback2 as feedback2,sif.stage1 as stage1,sif.stage2 as stage2,sif.total_percentage1 as total_percentage1,sif.total_percentage2 as total_percentage2,sif.other_tech_score1 as other_tech_score1,sif.other_tech_score2 as other_tech_score2,sif.selected_stage1 as selected_stage1,sif.selected_stage2 as selected_stage2,sif.schlolarship as schlolarship from student_master sm,student_assessment sa ,student_interview_feed_back sif,job_portal jp,users u where sa.student_assessment_id=(select student_assessment_id from student_assessment where student_id=:student_id order by student_assessment_id desc limit 1) and sif.student_feedback_id = (select student_feedback_id from student_interview_feed_back where student_id=:student_id order by student_feedback_id desc limit 1) and sm.student_id=:student_id and sm.organization_id=:organizationId and u.email=sm.email_id and jp.job_portal_id=sm.job_portal_id")
    @Query(nativeQuery = true, value = "select distinct  sa.correct_questions as correct_questions,sa.total_no_of_questions as total_questions, sm.profile_path as image_url,sm.student_id as student_id, jp.job_portal_title as job_title, jp.experience as experience,jp.interviews as no_of_rounds,jp.job_portal_id as job_portal_id,sm.profile_path as profilePath,u.image_url as image,sif.specialization as specialization, sm.first_name as first_name ,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2)) AS score_percent,sm.last_name as last_name ,sm.mobile_no as mobile_no ,sm.gender as gender ,sm.district as district,sm.dob as dob,sm.current_address as address,sm.email_id as email_id,sm.pincode as pincode ,sm.city as city,sm.state as states,sm.tenth_percentage as tenth_percentage, sm.twelveth_percentage as twelveth_percentage,sm.internship_nature as internship_nature,sm.stream as stream,sm.graduation_percentage as percentage ,sm.graduation_name as graduation_name,sm.graduation_year as graduation_year,sm.university_name as college_name ,sa.correct_questions as score,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.coding_percentage as coding_percent,sa.total_coding_score as coding_score,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2)) AS total_percentage ,sif.status as status,sif.interviewer_name as interviewer,sif.interviewer_name2 as interviewer2,sif.interviewer_name3 as interviewer3,sif.presentation_skills as presentation_skills,sif.presentation_skills2 as presentation_skills2,sif.presentation_skills3 as presentation_skills3,sif.coding_skills as coding_skills,sif.coding_skills2 as coding_skills2,sif.coding_skills3 as coding_skills3,sif.java_score as java_score,sif.java_score2 as java_score2,sif.java_score3 as java_score3,sif.oops_score as oops_score,sif.oops_score2 as oops_score2,sif.oops_score3 as oops_score3,sif.x_factor as x_factor,sif.x_factor2 as x_factor2,sif.x_factor3 as x_factor3,sif.other_tech as other_tech,sif.tech_name as tech_name,sif.other_tech2 as other_tech2,sif.other_tech3 as other_tech3,sif.total_score as total_score,sif.total_score2 as total_score2,sif.total_score3 as total_score3,sif.feedback1 as feedback1,sif.feedback2 as feedback2,sif.stage1 as stage1,sif.stage2 as stage2,sif.stage3 as stage3,sif.total_percentage1 as total_percentage1,sif.total_percentage2 as total_percentage2,sif.total_percentage3 as total_percentage3,sif.other_tech_score1 as other_tech_score1,sif.other_tech_score2 as other_tech_score2,sif.other_tech_score3 as other_tech_score3,sif.selected_stage1 as selected_stage1,sif.selected_stage2 as selected_stage2,sif.schlolarship as schlolarship from student_master sm,student_assessment sa,job_portal jp ,student_interview_feed_back sif,users u where sa.student_assessment_id=(select student_assessment_id from student_assessment where student_id=:student_id order by student_assessment_id desc limit 1) and sif.student_feedback_id = (select student_feedback_id from student_interview_feed_back where student_id=:student_id order by student_feedback_id desc limit 1) and sm.student_id=:student_id and sm.organization_id=:organizationId and u.email=sm.email_id and jp.job_portal_id=sm.job_portal_id")
    public List<LinkedCaseInsensitiveMap> getStudentAllDetails(@Param("student_id") Long student_id, @Param("organizationId") Long organizationId);

//    @Query(nativeQuery = true, value = "select distinct sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage or sif.stage3=:stage) and(sif.organization_id=:organizationId)  and (sm.job_portal_id=:jobId) order by created_date desc")
//    @Query(nativeQuery = true, value = "select distinct sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa,assign_interview as ai where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage or sif.stage3=:stage) and(sif.organization_id=:organizationId)and(sm.job_portal_id=:jobId) and (ai.job_portal_id =sm.job_portal_id and ai.no_of_round=:round) and(ai.interviewer_email=:email) order by created_date desc")
//    public List<LinkedCaseInsensitiveMap> getStudents(@Param("stage") String stage, @Param("organizationId") Long organizationId, @Param("jobId") Long jobId, @Param("email") String email, @Param("round") Long round);
    @Query(nativeQuery = true, value = "select distinct  round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score ,2) as ai_success_score ,sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa,assign_interview as ai where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage or sif.stage3=:stage) and(sif.organization_id=:organizationId)and(sm.job_portal_id=:jobId) and (ai.job_portal_id =sm.job_portal_id and ai.no_of_round=:round) and(ai.interviewer_email=:email) order by created_date desc")
    public List<LinkedCaseInsensitiveMap> getStudents(@Param("stage") String stage, @Param("organizationId") Long organizationId, @Param("jobId") Long jobId, @Param("email") String email, @Param("round") Long round);

    @Query("select student_id as student_id,jobPortalId as jobPortalId,profilePath as profilePath from StudentMaster where email_id=:email_id AND organizationId=:organizationId")
    public LinkedCaseInsensitiveMap findStudentIdByEmail(@Param("email_id") String email_id, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select sm.student_id as student_id from student_master sm inner join student_scholarship ss on ss.scholarship_id=sm.scholarship_id where sm.scholarship_id=:scholarship_id")
    public List<LinkedCaseInsensitiveMap> getStudentsByScholarship(@Param("scholarship_id") Long scholarshipId);

//    @Query("select sm.student_id as value, sm.first_name ||' '||COALESCE(sm.last_name,'') as name from StudentScholarship sc inner join StudentAssessment sa on (sa.totalPercentage) >= sc.scholarship_percentage and (sa.totalPercentage)<= sc.scholarship_percentage2 inner join StudentMaster sm on sm.student_id =sa.student_id where sc.scholarship_id=:scholarship_id order by sm.student_id")
//    public List<LinkedCaseInsensitiveMap> getStudentsForScholarship(@Param("scholarship_id") Long scholarship_id);
    @Query(nativeQuery = true, value = "SELECT sm.tenth_percentage AS tenth_percentage,sm.twelveth_percentage AS twelveth_percentage,sm.graduation_percentage AS graduation_percentage, coalesce(sifb.total_percentage1,0) AS intereview1,sifb.status AS interview2,Round(( sa.correct_questions / sa.total_no_of_questions ) * 100, 2) AS HiringAssessmentScore,sm.stream AS stream,sm.graduation_name AS graduation_name,coalesce(sm.work_experience,'No') AS work_experience,sm.internship_nature AS internship_nature FROM student_master sm,student_interview_feed_back sifb,student_assessment sa WHERE  sa.student_assessment_id = (SELECT student_assessment_id FROM student_assessment WHERE  student_id = :student_id ORDER  BY created_date DESC LIMIT  1) AND sifb.student_feedback_id = (SELECT student_feedback_id FROM student_interview_feed_back WHERE  student_id = :student_id ORDER  BY student_feedback_id DESC LIMIT  1) AND sm.student_id = :student_id")
    public String getDataToPredictAIScore(@Param("student_id") Long student_id);

    @Query(nativeQuery = true, value = "select smu.path as media_path ,smu.mediatype as media_type,iq.ques_id as question_id,iq.question as question from student_media_upload smu left join inter_quest iq on iq.ques_id=smu.question_id where smu.student_id=:student_id")
    public List<LinkedCaseInsensitiveMap> getResumeAndVideo(@Param("student_id") Long student_id);

    @Query(nativeQuery = true, value = "select distinct  sa.correct_questions as correct_questions,sa.total_no_of_questions as total_questions, sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage, coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date, sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa , candidate_master as cm where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1 ) and sm.email_id IN(select distinct email from candidate_master where sender=:email) order by created_date desc")
    public Set<LinkedCaseInsensitiveMap> getAllStudentsForRecruiter(@Param("email") String email);

//    @Query(nativeQuery = true, value = "select distinct sm.student_id as student_id, sm.first_name as first_name,sm.profile_path as profilePath ,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS score_percent,sm.last_name as last_name ,sm.mobile_no as mobile_no ,sm.gender as gender ,sm.district as district,sm.dob as dob,sm.current_address as address,sm.email_id as email_id,sm.pincode as pincode ,sm.city as city,sm.state as states,sm.tenth_percentage as tenth_percentage, sm.twelveth_percentage as twelveth_percentage,sm.internship_nature as internship_nature,sm.stream as stream,sm.graduation_percentage as percentage ,sm.graduation_name as graduation_name,sm.graduation_year as graduation_year,sm.university_name as college_name ,sa.correct_questions as score,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.coding_percentage as coding_percent,sa.total_coding_score as coding_score,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS total_percentage ,sif.status as status,sif.interviewer_name as interviewer,sif.interviewer_name2 as interviewer2,sif.presentation_skills as presentation_skills,sif.presentation_skills2 as presentation_skills2,sif.coding_skills as coding_skills,sif.coding_skills2 as coding_skills2,sif.java_score as java_score,sif.java_score2 as java_score2,sif.oops_score as oops_score,sif.oops_score2 as oops_score2,sif.specialization as specialization,sif.x_factor as x_factor,sif.x_factor2 as x_factor2,sif.other_tech as other_tech,sif.other_tech2 as other_tech2,sif.total_score as total_score,sif.tech_name as tech_name,sif.total_score2 as total_score2,sif.feedback1 as feedback1,sif.feedback2 as feedback2,sif.stage1 as stage1,sif.stage2 as stage2,sif.total_percentage1 as total_percentage1,sif.total_percentage2 as total_percentage2,sif.other_tech_score1 as other_tech_score1,sif.other_tech_score2 as other_tech_score2,sif.selected_stage1 as selected_stage1,sif.selected_stage2 as selected_stage2,sif.schlolarship as schlolarship from student_master sm, student_assessment sa ,student_interview_feed_back sif,users u where sa.student_assessment_id=(select student_assessment_id from student_assessment where student_id=:student_id order by student_assessment_id desc limit 1) and sif.student_feedback_id = (select student_feedback_id from student_interview_feed_back where student_id=:student_id order by student_feedback_id desc limit 1) and sm.student_id=:student_id")
    @Query(nativeQuery = true, value = "select distinct sa.correct_questions as correct_questions,sa.total_no_of_questions as total_questions, sm.student_id as student_id, jp.job_portal_title as job_title,jp.interviews as no_of_rounds,jp.job_portal_id as job_portal_id, sm.first_name as first_name,sm.profile_path as profilePath ,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2)) AS score_percent,sm.last_name as last_name ,sm.mobile_no as mobile_no ,sm.gender as gender ,sm.district as district,sm.dob as dob,sm.current_address as address,sm.email_id as email_id,sm.pincode as pincode ,sm.city as city,sm.state as states,sm.tenth_percentage as tenth_percentage, sm.twelveth_percentage as twelveth_percentage,sm.internship_nature as internship_nature,sm.stream as stream,sm.graduation_percentage as percentage ,sm.graduation_name as graduation_name,sm.graduation_year as graduation_year,sm.university_name as college_name ,sa.correct_questions as score,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.coding_percentage as coding_percent,sa.total_coding_score as coding_score,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2)) AS total_percentage ,sif.status as status,sif.interviewer_name as interviewer,sif.interviewer_name2 as interviewer2,sif.interviewer_name3 as interviewer3,sif.presentation_skills as presentation_skills,sif.presentation_skills2 as presentation_skills2,sif.presentation_skills3 as presentation_skills3,sif.coding_skills as coding_skills,sif.coding_skills2 as coding_skills2,sif.coding_skills3 as coding_skills3,sif.java_score as java_score,sif.java_score2 as java_score2,sif.java_score3 as java_score3,sif.oops_score as oops_score,sif.oops_score2 as oops_score2,sif.oops_score3 as oops_score3,sif.specialization as specialization,sif.x_factor as x_factor,sif.x_factor2 as x_factor2,sif.x_factor3 as x_factor3,sif.other_tech as other_tech,sif.other_tech2 as other_tech2,sif.other_tech3 as other_tech3,sif.total_score as total_score,sif.tech_name as tech_name,sif.total_score2 as total_score2,sif.total_score3 as total_score3,sif.feedback1 as feedback1,sif.feedback2 as feedback2,sif.stage1 as stage1,sif.stage2 as stage2,sif.stage3 as stage3,sif.total_percentage1 as total_percentage1,sif.total_percentage2 as total_percentage2,sif.total_percentage3 as total_percentage3,sif.other_tech_score1 as other_tech_score1,sif.other_tech_score2 as other_tech_score2,sif.other_tech_score3 as other_tech_score3,sif.selected_stage1 as selected_stage1,sif.schlolarship as schlolarship from student_master sm,job_portal jp ,student_assessment sa ,student_interview_feed_back sif,users u where sa.student_assessment_id=(select student_assessment_id from student_assessment where student_id=:student_id order by student_assessment_id desc limit 1) and sif.student_feedback_id = (select student_feedback_id from student_interview_feed_back where student_id=:student_id order by student_feedback_id desc limit 1) and sm.student_id=:student_id and jp.job_portal_id=sm.job_portal_id")
    public List<LinkedCaseInsensitiveMap> getRegStudentAllDetails(@Param("student_id") Long student_id);

//    @Query(nativeQuery = true, value = "select distinct round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score, 2) as ai_success_score,sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.organization_id=:organizationId and sm.job_portal_id=:jobId order by created_date desc")
//    @Query(nativeQuery = true, value = "select distinct (select rcassessment_desc from rcassessment_creation where rcassessment_id=assessment_id) as assessment_name,sa.remarks as remarks,sa.correct_questions as correct_questions,sa.total_no_of_questions as total_questions,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score, 2) as ai_success_score,sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.grdauation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.organization_id=:organizationId and sm.job_portal_id=:jobId order by created_date desc")
//    @Query(nativeQuery = true , value = "select distinct (select rcassessment_desc from rcassessment_creation where rcassessment_id=assessment_id) as assessment_name,sa.remarks as remarks,sv.created_time as start_time,sa.end_time as end_time,sa.correct_questions as correct_questions,sa.total_no_of_questions as total_questions,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score, 2) as ai_success_score,sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa,student_validate sv where sm.student_id=sa.student_id and sv.id=(select sv.id   from student_validate sv Where sv.email=sm.email_id order by sv.id desc limit 0,1) and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sm.organization_id=:organizationId) and (sm.job_portal_id=:jobId) order by created_date desc")
    @Query(nativeQuery = true, value = "select distinct (select rcassessment_desc from rcassessment_creation where rcassessment_id=assessment_id) as assessment_name,sm.email_id as email,sa.remarks as remarks,date_format(sv.created_time,\"%d-%m-%Y %H:%i:%s\") as start_time,date_format(sa.end_time,\"%d-%m-%Y %H:%i:%s\")  as end_time,sa.correct_questions as correct_questions,sa.total_no_of_questions as total_questions,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score, 2) as ai_success_score,sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa,student_validate sv where sm.student_id=sa.student_id and sv.id=(select sv.id   from student_validate sv Where sv.email=sm.email_id order by sv.id desc limit 0,1) and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.organization_id=:organizationId and sm.job_portal_id=:jobId order by created_date desc")
    public Set<LinkedCaseInsensitiveMap> assessmentCompleted(@Param("organizationId") Long organizationId, @Param("jobId") Long jobId);

    @Query(nativeQuery = true, value = "select sif.status as status ,sif.organization_id as organization_id,sif.progress_percentage as progress_percentage, sif.student_id as student_id , sif.student_feedback_id as student_feedback_id from student_interview_feed_back sif where sif.student_id=:student_id and sif.status='Assessment Completed' order by sif.student_feedback_id desc limit 1")
    public LinkedCaseInsensitiveMap assStndtByAssCompltd(@Param("student_id") Long student_id);

    @Query(nativeQuery = true, value = "select distinct round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score, 2)as ai_success_score, sm.student_id as student_id,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage, coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score, sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa , candidate_master as cm where sm.student_id=sa.student_id and sm.organization_id=:organizationId and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1 ) and sm.email_id IN(select distinct email from candidate_master where sender=:email) and sm.job_portal_id=:jobId order by created_date desc")
    public Set<LinkedCaseInsensitiveMap> getAllCompleAssessmentForRecruiter(@Param("email") String email, @Param("organizationId") Long organizationId, @Param("jobId") Long jobId);

    @Query(nativeQuery = true, value = "select sa.student_assessment_id as student_assessment_id, sa.assessment_id as assessment_id, sa.student_id as student_id,sa.total_no_of_questions as total_questions from student_assessment sa where sa.student_id=:studentId order by sa.student_assessment_id desc limit 0,1 ")
    public LinkedCaseInsensitiveMap givenAssessments(@Param("studentId") Long studentId);

    @Query(nativeQuery = true, value = "select sad.question_id as question_id from student_assessment_details sad INNER JOIN question_option_mapping qom ON qom.option_id=sad.answer and qom.is_active='Y' where sad.student_assessment_id=:studentAssessmentId ")
    public List<LinkedCaseInsensitiveMap> correctQuestions(@Param("studentAssessmentId") Long studentAssessmentId);

    @Query(nativeQuery = true, value = "select count(aq.question_id) as topicCount from assessment_question aq JOIN question_master qm ON qm.question_id=aq.question_id and qm.language_id=:language_id and qm.question_type_id=1 where assessment_id=:assessment_id")
    public List<LinkedCaseInsensitiveMap> totalQuestionOfTopic(@Param("language_id") Long language_id, @Param("assessment_id") Long assessment_id);

///    @Query(nativeQuery = true, value = "select concat(round((sum(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))))/sum(case when ( sa.correct_questions/sa.total_no_of_questions * 100 ) > 0 then 1 else 0 end ),2)) AS avg_rc_score,floor(min( (sa.correct_questions/sa.total_no_of_questions) * 100 )) As min_rc_score,max(concat(round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2))) As max_rc_score,concat(round(sum(sm.ai_score)/sum(case when sm.ai_score > 0 then 1 else 0 end ),2)) as avg_ai_score,min(sm.ai_score) as min_ai_score,max(sm.ai_score) As max_ai_score,concat(round(sum(sa.coding_percentage)/sum(case when sa.coding_percentage > 0 then 1 else 0 end ),2)) As avg_coding_score,min(sa.coding_percentage) As min_coding_score, max(sa.coding_percentage) as max_coding_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organization_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage)order by sa.created_date desc")
    @Query(nativeQuery = true, value = "select concat(round((sum(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))))/sum(case when ( sa.correct_questions/sa.total_no_of_questions * 100 ) > 0 then 1 else 0 end ),2)) AS avg_rc_score,floor(min( (sa.correct_questions/sa.total_no_of_questions) * 100 )) As min_rc_score,max(concat(round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2))) As max_rc_score,concat(round(sum(sm.ai_score)/sum(case when sm.ai_score > 0 then 1 else 0 end ),2)) as avg_ai_score,min(sm.ai_score) as min_ai_score,max(sm.ai_score) As max_ai_score,concat(round(sum(sa.coding_percentage)/sum(case when sa.coding_percentage > 0 then 1 else 0 end ),2)) As avg_coding_score,min(sa.coding_percentage) As min_coding_score, max(sa.coding_percentage) as max_coding_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organization_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status='interview1' or sif.stage1='interview1' or sif.stage2='interview2'or sif.stage3='interview3') and (sm.job_portal_id IN(:jobPortalIds))order by sa.created_date desc")
    public LinkedCaseInsensitiveMap stdntsAllAvgScores(@Param("organization_id") Long organizationId, @Param("jobPortalIds") List<Long> jobPortalIds);

//    @Query(nativeQuery = true, value = "select concat(round(sum(sif.total_percentage1)/sum(case when sif.total_percentage1 > 0 then 1 else 0 end ),2)) As avg_stage1_score,min(sif.total_percentage1) as min_stage1_score,max(sif.total_percentage1) As max_stage1_score,concat(round(sum(sif.total_percentage2)/sum(case when sif.total_percentage2 > 0 then 1 else 0 end ))) As avg_stage2_score,min(sif.total_percentage2) As min_stage2_score,max(sif.total_percentage2) As max_stage2_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organization_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id)  order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage)order by sa.created_date desc")
//    @Query(nativeQuery = true, value = "select concat(round(sum(sif.total_percentage1)/sum(case when sif.total_percentage1 > 0 then 1 else 0 end ),2)) As avg_stage1_score,min(sif.total_percentage1) as min_stage1_score,max(sif.total_percentage1) As max_stage1_score,concat(round(sum(sif.total_percentage2)/sum(case when sif.total_percentage2 > 0 then 1 else 0 end ))) As avg_stage2_score,min(sif.total_percentage2) As min_stage2_score,max(sif.total_percentage2) As max_stage2_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organization_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id)  order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status='interview1' or sif.stage1='interview1' or sif.stage2='interview2') and(sm.job_portal_id IN(:jobPortalIds))order by sa.created_date desc")
    @Query(nativeQuery = true, value = "select concat(round(sum(sif.total_percentage1)/sum(case when sif.total_percentage1 > 0 then 1 else 0 end ),2)) As avg_stage1_score,min(sif.total_percentage1) as min_stage1_score,max(sif.total_percentage1) As max_stage1_score,concat(round(sum(sif.total_percentage2)/sum(case when sif.total_percentage2 > 0 then 1 else 0 end ))) As avg_stage2_score,min(sif.total_percentage2) As min_stage2_score,max(sif.total_percentage2) As max_stage2_score,concat(round(sum(sif.total_percentage3)/sum(case when sif.total_percentage3 > 0 then 1 else 0 end ))) As avg_stage3_score,min(sif.total_percentage3) As min_stage3_score,max(sif.total_percentage3) As max_stage3_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organization_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id)  order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status='interview1' or sif.stage1='interview1' or sif.stage2='interview2' or sif.stage3='interview3') and(sm.job_portal_id IN(:jobPortalIds))order by sa.created_date desc")
    public LinkedCaseInsensitiveMap allStagesAvgScores(@Param("organization_id") Long organizationId, @Param("jobPortalIds") List<Long> jobPortalIds);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id and (sa.created_date>=:startDate and sa.created_date<=:endDate) order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status='interview1' or sif.stage1='interview1') order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int totalStdntsInt1Search(@Param("collegeName") Long organizationId, @Param("collegeName") String collegeName, @Param("startDate") Date startDate, @Param("endDate") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status='interview1' or sif.stage1='interview1')order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName) and (sm.created_date>=:startDate and sm.created_date<=:endDate) and (sif.status='interview1' or sif.stage1='interview1') ")
    public int oneDayTotalStdntsInt1Search(@Param("collegeName") String collegeName, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status='interview2' or sif.stage2='interview2') order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int stage2CountSearch(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status='interview2' or sif.stage2='interview2') and (sif.last_modified_date>=:startDate and sif.last_modified_date<=:endDate) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int oneDayStage2CountSearch(@Param("collegeName") String collegeName, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:stage) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int statusWiseCountSearch(@Param("collegeName") String collegeName, @Param("stage") String stage, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:stage or sif.stage2=:stage or sif.stage1=:stage) and (sif.last_modified_date>=:startDate and sif.last_modified_date<=:endDate) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int oneDayStatusWiseCountSearch(@Param("collegeName") String collegeName, @Param("stage") String stage, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "select concat(round((sum(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))))/sum(case when ( sa.correct_questions/sa.total_no_of_questions * 100 ) > 0 then 1 else 0 end ),2)) AS avg_rc_score,floor(min( sa.correct_questions/sa.total_no_of_questions * 100 )) As min_rc_score,max(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))) As max_rc_score,concat(round(sum(sm.ai_score)/sum(case when sm.ai_score > 0 then 1 else 0 end ),2)) as avg_ai_score,min(sm.ai_score) as min_ai_score,max(sm.ai_score) As max_ai_score,concat(round(sum(sa.coding_percentage)/sum(case when sa.coding_percentage > 0 then 1 else 0 end ),2)) As avg_coding_score,min(sa.coding_percentage) As min_coding_score, max(sa.coding_percentage) as max_coding_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) and lower(sm.university_name)=lower(:collegeName) and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage)order by sa.created_date desc")
    public LinkedCaseInsensitiveMap allScoresByClgName(@Param("collegeName") String collegeName, @Param("stage") String stage, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

//    @Query(nativeQuery = true, value = "select concat(round(sum(sif.total_percentage1)/sum(case when sif.total_percentage1 > 0 then 1 else 0 end ),2)) As avg_stage1_score,min(sif.total_percentage1) as min_stage1_score,max(sif.total_percentage1) As max_stage1_score,concat(round(sum(sif.total_percentage2)/sum(case when sif.total_percentage2 > 0 then 1 else 0 end ))) As avg_stage2_score,min(sif.total_percentage2) As min_stage2_score,max(sif.total_percentage2) As max_stage2_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id)  order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and lower(sm.university_name)=lower(:collegeName) order by sa.created_date desc")
//    public LinkedCaseInsensitiveMap allStagesScoreByClgName(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);
//    @Query(nativeQuery = true, value = "select distinct concat(round((sum(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))))/sum(case when ( sa.correct_questions/sa.total_no_of_questions * 100 ) > 0 then 1 else 0 end ),2)) AS avg_rc_score,Round(min((sa.correct_questions/sa.total_no_of_questions)*100),2) As min_rc_score,Round(max( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) As max_rc_score,concat(round(sum(sm.ai_score)/sum(case when sm.ai_score > 0 then 1 else 0 end ),2)) as avg_ai_score,min(sm.ai_score) as min_ai_score,max(sm.ai_score) As max_ai_score,concat(round(sum(sa.coding_percentage)/sum(case when sa.coding_percentage > 0 then 1 else 0 end ),2)) As avg_coding_score,min(sa.coding_percentage) As min_coding_score, max(sa.coding_percentage) as max_coding_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa , candidate_master as cm where  sm.student_id=sa.student_id and sm.organization_id=:organizationId and  sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.email_id IN(select distinct email from candidate_master where sender=:email) order by sa.created_date desc")
//    public LinkedCaseInsensitiveMap allStdntsScoresForRec(@Param("email") String email, @Param("organizationId") Long organizationId);
    @Query(nativeQuery = true, value = "select distinct concat(round(sum(sif.total_percentage1)/sum(case when sif.total_percentage1 > 0 then 1 else 0 end ),2)) As avg_stage1_score,min(sif.total_percentage1) as min_stage1_score,max(sif.total_percentage1) As max_stage1_score,concat(round(sum(sif.total_percentage2)/sum(case when sif.total_percentage2 > 0 then 1 else 0 end ))) As avg_stage2_score,min(sif.total_percentage2) As min_stage2_score,max(sif.total_percentage2) As max_stage2_score,concat(round(sum(sif.total_percentage3)/sum(case when sif.total_percentage3 > 0 then 1 else 0 end ))) As avg_stage3_score,min(sif.total_percentage3) As min_stage3_score,max(sif.total_percentage3) As max_stage3_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id)  order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.email_id IN(select distinct email from candidate_master where sender=:email)order by sa.created_date desc")
    public LinkedCaseInsensitiveMap stdntsStagesAllScres(@Param("email") String email, @Param("organizationId") Long organizationId);

//    @Query(nativeQuery = true, value = "select   concat(round((sum(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))))/sum(case when ( sa.correct_questions/sa.total_no_of_questions * 100 ) > 0 then 1 else 0 end ),2)) AS avg_rc_score,min(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))) As min_rc_score,max(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))) As max_rc_score,concat(round(sum(sm.ai_score)/sum(case when sm.ai_score > 0 then 1 else 0 end ),2)) as avg_ai_score,min(sm.ai_score) as min_ai_score,max(sm.ai_score) As max_ai_score,concat(round(sum(sa.coding_percentage)/sum(case when sa.coding_percentage > 0 then 1 else 0 end ),2)) As avg_coding_score,min(sa.coding_percentage) As min_coding_score, max(sa.coding_percentage) as max_coding_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.organization_id=:organizationId) order by sa.created_date desc")
    @Query(nativeQuery = true, value = "select   concat(round((sum(concat(round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2))))/sum(case when ( (sa.correct_questions/sa.total_no_of_questions) * 100 ) > 0 then 1 else 0 end ),2)) AS avg_rc_score,Round(min((sa.correct_questions/sa.total_no_of_questions)*100),2) As min_rc_score,Round(max( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) As max_rc_score,concat(round(sum(sm.ai_score)/sum(case when sm.ai_score > 0 then 1 else 0 end ),2)) as avg_ai_score,min(sm.ai_score) as min_ai_score,max(sm.ai_score) As max_ai_score,concat(round(sum(sa.coding_percentage)/sum(case when sa.coding_percentage > 0 then 1 else 0 end ),2)) As avg_coding_score,min(sa.coding_percentage) As min_coding_score, max(sa.coding_percentage) as max_coding_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sif.organization_id=:organizationId) and (sm.organization_id=:organizationId) order by sa.created_date desc")
    public LinkedCaseInsensitiveMap stdntsAllAvgScoresForRec(@Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select concat(round(sum(sif.total_percentage1)/sum(case when sif.total_percentage1 > 0 then 1 else 0 end ),2)) As avg_stage1_score,min(sif.total_percentage1) as min_stage1_score,max(sif.total_percentage1) As max_stage1_score,concat(round(sum(sif.total_percentage2)/sum(case when sif.total_percentage2 > 0 then 1 else 0 end ))) As avg_stage2_score,min(sif.total_percentage2) As min_stage2_score,max(sif.total_percentage2) As max_stage2_score,concat(round(sum(sif.total_percentage3)/sum(case when sif.total_percentage3 > 0 then 1 else 0 end ))) As avg_stage3_score,min(sif.total_percentage3) As min_stage3_score,max(sif.total_percentage3) As max_stage3_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id)  order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.organization_id=:organizationId order by sa.created_date desc")
    public LinkedCaseInsensitiveMap stdntsStagesAllScresForRec(@Param("organizationId") Long organizationId);

//    @Query("SELECT count(*) FROM StudentMaster where organization_id=:organizationId")
    @Query(nativeQuery = true, value = "SELECT count( sm.student_id) FROM student_master sm INNER JOIN  student_interview_feed_back sif where sif.student_id=sm.student_id and sif.organization_id=:organization_id")
    public int totalStudents(@Param("organization_id") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm where (sm.created_date>=:startDate and sm.created_date<=:endDate) and sm.organization_id=:organizationId")
    public int dayOneStudents(@Param("startDate") Date startDate, @Param("endDate") Date endDate, @Param("organizationId") Long organizationId);

//    @Query(nativeQuery = true, value = "SELECT bm.badge_id as badge_id,bm.badge_name as badge_name, bm.badge_desc as badge_desc,bm.badge_type as badge_type,bm.url as url FROM student_badge_mapping sbm JOIN badge_master bm ON bm.badge_id=sbm.badge_id where sbm.student_id=:studentId")
//    public List<LinkedCaseInsensitiveMap> studentBadges(@Param("studentId") Long student_id);
    @Query(nativeQuery = true, value = "SELECT sm.student_id as student_id,sa.correct_questions as correct_questions,floor((sa.correct_questions/sa.total_no_of_questions) * 100) as percentage from student_master sm inner join student_assessment sa on sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id limit 0,1) left join users u on u.email=sm.email_id order By percentage desc")
    public List<LinkedCaseInsensitiveMap> studentsMcqRank();

    @Query(nativeQuery = true, value = "select sm.student_id as student_id,sa.coding_percentage as coding_percentage from student_master sm, student_assessment sa , users u where sa.student_id=sm.student_id and sa.student_assessment_id =(select sa.student_assessment_id from student_assessment sa where sa.student_id IN(sm.student_id) order by sa.student_assessment_id desc limit 0,1) and u.email=sm.email_id order by coding_percentage desc")
    public List<LinkedCaseInsensitiveMap> studentsCodingRank();

//    @Modifying
//    @Transactional
//    @Query("UPDATE StudentMaster sm SET sm.candStageMsg1Date=:date, sm.email_notification=:student_msg where sm.student_id=:student_id")
//    public void updateStudentNotification(@Param("student_msg") String student_msg, @Param("student_id") Long student_id, @DateTimeFormat(pattern = "yyyy/MM/dd HH:mm:ss") @Param("date") Date currDate);
//    @Query(nativeQuery = true, value = "select sad.question_id as question_id from student_assessment_details sad where sad.student_assessment_id=:studentAssessmentId ")
//    public List<LinkedCaseInsensitiveMap> totalQuestionsIds(@Param("studentAssessmentId") Long studentAssessmentId);
    @Query(nativeQuery = true, value = "select sa.created_date as created_date,sa.total_percentage as total_percentage,lm.language_name as language_name from student_master sm,student_assessment sa,rcassessment_creation rc,language_master lm where sm.organization_id=:organizationId and sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc limit 0,1) and rc.rcassessment_id=sa.assessment_id and lm.language_id=rc.language_id")
    public List<LinkedCaseInsensitiveMap> totalCadForTechAdmin(@Param("organizationId") Long organizationId);

//    @Query(nativeQuery = true, value = "select coalesce(sum((case when( (sa.correct_questions/sa.total_no_of_questions) * 100 ) > 60 then 1 else 0 end)),0) as totalPassingCand from student_master sm inner join student_assessment sa on sa.student_assessment_id= (select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc limit 0,1)  inner join rcassessment_creation rc on rc.rcassessment_id=sa.assessment_id where sm.organization_id=:organizationId")
//    public int totalCandPassingCountTechAdmin(@Param("organizationId") Long organizationId);
    @Query(nativeQuery = true, value = "select count(sm.student_id) as lang_count from student_master sm inner join student_assessment sa on sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1)inner join rcassessment_creation rc  on rc.rcassessment_id=sa.assessment_id inner join language_master lm on lm.language_id=rc.language_id and lm.language_name=:language_name where sm.organization_id=:organizationId")
    public int candLangCount(@Param("language_name") String language_name, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select coalesce(sum(case when ( (sa.correct_questions/sa.total_no_of_questions) * 100 ) > 60 then 1 else 0 end),0)  as candLangPassing  from student_master sm inner join student_assessment sa on sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1)inner join rcassessment_creation rc  on rc.rcassessment_id=sa.assessment_id inner join language_master lm on lm.language_id=rc.language_id and lm.language_name=:language_name and sm.organization_id=:organizationId")
    public int candLangPassingCount(@Param("language_name") String language_name, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select sm.first_name,sm.student_id,rc.rcassessment_desc,lm.language_name,sa.created_date from student_master sm inner join student_assessment sa on sa.student_assessment_id= (select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id and sa.created_date>=:startDate and sa.created_date<=:endDate order by sa.student_assessment_id desc limit 0,1)  inner join rcassessment_creation rc on rc.rcassessment_id=sa.assessment_id inner join language_master lm on lm.language_id=rc.language_id and sm.organization_id=:organizationId")
    public List<LinkedCaseInsensitiveMap> WeekByListForTechAdmin(@Param("startDate") Date startDate, @Param("endDate") Date endDate, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (lower(sif.selected_stage1)=lower('Yes')) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int yesCandIntv1Search(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and lower(sif.selected_stage1)=lower('Yes') and (sif.last_modified_date>=:startDate and sif.last_modified_date<=:endDate) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int yesCandIntv1ADaySearch(@Param("collegeName") String collegeName, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and lower(sif.selected_stage1)=lower('Yes') and lower(sif.status)=lower('Selected') order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int yesCandSelectedSearch(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and lower(sif.selected_stage1)=lower('Yes') and lower(sif.status)=lower('Selected') and (sif.last_modified_date>=:startDate and sif.last_modified_date<=:endDate) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int yesCandSelectedADaySearch(@Param("collegeName") String collegeName, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "SELECT  sm.first_name as first_name,sm.last_name as last_name,sm.profile_path as image_url,sa.correct_questions as correct_questions,floor((sa.correct_questions/sa.total_no_of_questions) * 100) as percentage from student_master sm inner join  student_assessment sa on  sa.student_assessment_id =(select sa.student_assessment_id from student_assessment sa where sa.student_id IN(sm.student_id) and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by sa.student_assessment_id desc limit 0,1) inner join student_interview_feed_back sif on sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN(sm.student_id) and (sif.status=:stage) and lower(sm.university_name)=lower(:collegeName) order by sif.student_feedback_id desc limit 0,1) left join users u on  u.email=sm.email_id order by percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> assmentLeaderByClg(@Param("stage") String stage, @Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "select sm.email_id ,sif.status as stage, sm.student_id as student_id,sm.first_name as first_name, sm.last_name as last_name , sa.coding_percentage as coding_percentage,sm.profile_path as image_url from student_master sm inner join  student_assessment sa on  sa.student_assessment_id =(select sa.student_assessment_id from student_assessment sa where sa.student_id IN(sm.student_id) order by sa.student_assessment_id desc limit 0,1) and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) inner join student_interview_feed_back sif on sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN(sm.student_id)  and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage) and lower(sm.university_name)=lower(:collegeName) order by sif.student_feedback_id desc limit 0,1) left join users u on  u.email=sm.email_id order by sa.coding_percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> topCoderByClg(@Param("stage") String stage, @Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status='stage2' or sif.stage2='stage2') order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int totalStdntsInt2Search(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status='stage2' or sif.stage2='stage2') order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName) and (sm.created_date>=:startDate and sm.created_date<=:endDate)")
    public int oneDayTotalStdntsInt2Search(@Param("collegeName") String collegeName, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:selected or sif.status=:rejected) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int intv2Completed(@Param("collegeName") String collegeName, @Param("selected") String selected, @Param("rejected") String rejected, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:selected or sif.status=:rejected) and (sif.last_modified_date>=:startDate and sif.last_modified_date<=:endDate) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int oneDayIntv2Completed(@Param("collegeName") String collegeName, @Param("selected") String selected, @Param("rejected") String rejected, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage) and (sif.last_modified_date>=:startDate and sif.last_modified_date<=:endDate) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int oneDayIntv2TotalPending(@Param("collegeName") String collegeName, @Param("stage") String stage, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage) order by sif.student_feedback_id desc  limit 0,1) where lower(sm.university_name)=lower(:collegeName)")
    public int intv2TotalPending(@Param("collegeName") String collegeName, @Param("stage") String stage, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

//    @Query(nativeQuery = true, value = "select distinct lm.language_name as language_name, rc.rcassessment_id as rcassessment_id,rc.rcassessment_desc as rcassessment_desc  FROM  rcassessment_creation rc inner join language_master lm on rc.language_id=lm.language_id inner join student_assessment sa on sa.student_assessment_id =(select sa.student_assessment_id from student_assessment WHERE sa.assessment_id=rc.rcassessment_id order by created_date desc limit 0,1) WHERE rc.active='Y' and rc.organization_id=:organizationId")
//    public List<LinkedCaseInsensitiveMap> activeAssessmentId(@Param("organizationId") Long organizationId);
    @Query(nativeQuery = true, value = "select sa.total_percentage as total_percentage from student_assessment sa inner join rcassessment_creation rc on rc.rcassessment_id=sa.assessment_id Where sa.assessment_id=:assessmentId")
    public List<Double> avgScoresForTechAdmin(@Param("assessmentId") Long assessmentId);

//    @Query(nativeQuery = true, value = "select sa.student_id as student_id from student_master sm inner join student_assessment sa on sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id and sa.assessment_id=:assessmentId and sm.organization_id=:organizationId order by sa.student_assessment_id desc limit 0,1)")
//    public List<LinkedCaseInsensitiveMap> getStntByAssessmentId(@Param("assessmentId") Long assessmentId, @Param("organizationId") Long organizationId);
//    @Query(nativeQuery = true, value = "select coalesce((qom.is_active),null,'N') as ques_anwer,sa.student_assessment_id as student_assessment_id,sa.student_id as student_id,sad.question_id as question_id,sad.answer as answer from  student_assessment sa inner join student_master sm on sa.student_id=sm.student_id inner join student_assessment_details sad on sad.student_assessment_id=sa.student_assessment_id left join question_option_mapping qom on qom.question_id=sad.question_id and qom.option_id=sad.answer where sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=:student_id and sa.assessment_id=:assessmentId and sm.organization_id=:organizationId order by sa.student_assessment_id desc limit 0,1)")
//    public List<LinkedCaseInsensitiveMap> getStudentAnwersByAssessmentId(@Param("student_id") Long student_id, @Param("assessmentId") Long assessmentId, @Param("organizationId") Long organizationId);
//    @Query(nativeQuery = true, value = "SELECT lm.language_name as language_name,qm.question_desc as question_desc,qt.question_type_name as question_type From question_master qm inner join language_master lm on lm.language_id=qm.language_id  inner join question_type qt on qt.question_type_id=qm.question_type_id  where qm.question_id=:question_id and qm.organization_id=:organizationId")
//    public LinkedCaseInsensitiveMap getQuestionDesc(@Param("question_id") Long question_id, @Param("organizationId") Long organizationId);
    @Query(nativeQuery = true, value = "select distinct sm.student_id ,sm.first_name as first_name,sm.profile_path as image_url ,sm.last_name as last_name,sa.correct_questions as correct_questions,concat(round(((sa.correct_questions/sa.total_no_of_questions) * 100 ))) as percentage From student_master sm, student_interview_feed_back as sif,student_assessment as sa, candidate_master as cm , users u where  sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by student_assessment_id desc limit 1) and sm.email_id IN(select distinct email from candidate_master where sender=:email) and u.email=sm.email_id and sm.university_name=:collegeName order by percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> recAssLeaders(@Param("email") String email, @Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "select distinct sm.email_id ,sif.status as stage, sm.student_id as student_id,sm.first_name as first_name, sm.last_name as last_name , sa.coding_percentage as coding_percentage,sm.profile_path as image_url From student_master sm, student_interview_feed_back as sif,student_assessment as sa, candidate_master as cm , users u where  sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by student_assessment_id desc limit 1) and sm.email_id IN(select distinct email from candidate_master where sender=:email) and u.email=sm.email_id and sm.university_name=:collegeName order by coding_percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> recTopCoders(@Param("email") String email, @Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm where sm.university_name=:collegeName and (sm.created_date>=:startDate1 and sm.created_date<=:endDate1)")
    public int recManTotalStudents(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm where (sm.created_date>=:startDate and sm.created_date<=:endDate) and sm.university_name=:collegeName")
    public int recManDayOneStudents(@Param("collegeName") String collegeName, @Param("startDate") Date date1, @Param("endDate") Date date2);

    @Query(nativeQuery = true, value = "select distinct sm.student_id ,sm.first_name as first_name,sm.profile_path as image_url ,sm.last_name as last_name,sa.correct_questions as correct_questions,concat(round(((sa.correct_questions/sa.total_no_of_questions) * 100 ))) as percentage From student_master sm, student_interview_feed_back as sif,student_assessment as sa, users u where  sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by student_assessment_id desc limit 1)  and u.email=sm.email_id and sm.university_name=:collegeName order by percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> recManAssLeadersByClg(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "select distinct sm.email_id ,sif.status as stage, sm.student_id as student_id,sm.first_name as first_name, sm.last_name as last_name , sa.coding_percentage as coding_percentage,sm.profile_path as image_url From student_master sm, student_interview_feed_back as sif,student_assessment as sa, users u where  sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) order by student_assessment_id desc limit 1)  and u.email=sm.email_id and sm.university_name=:collegeName order by coding_percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> recManTopCodersByClg(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);
//
//    @Query("SELECT u.imageUrl as imageUrl FROM User u WHERE u.email=:email")
//    public String getImageUrl(@Param("email") String email);

//    @Modifying
//    @Transactional
//    @Query("UPDATE StudentMaster sm SET sm.follow_up=:follow_up, sm.recruiter_email=:email ,sm.recruiter_followup_date=:date where sm.student_id=:student_id")
//    public void updatefollowUpStudents(@Param("student_id") Long student_id, @Param("email") String email, @Param("follow_up") Long follow_up, @DateTimeFormat(pattern = "yyyy/MM/dd HH:mm:ss") @Param("date") Date currDate);
    @Query(nativeQuery = true, value = "SELECT tech_skill_required FROM student_master sm INNER JOIN job_portal jp on  jp.job_portal_id=sm.job_portal_id where sm.student_id=:student_id")
    public String getJobProfileNameByStudentId(@Param("student_id") Long student_id);

//    @Query(nativeQuery = true, value = "select distinct sm.student_id as student_id,sm.follow_up as follow_up,sm.recruiter_email as recruiter_email,sm.recruiter_followup_date as follow_up_date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sm.organization_id=:organizationId and sm.job_portal_id =:job_portal_id and sm.follow_up=1 and sm.recruiter_email=:email)order by sm.student_id desc")
    @Query(nativeQuery = true, value = "select distinct sif.total_percentage1 as interview1_score,sm.profile_path as image_url,sif.total_percentage2 as interview2_score,sa.coding_percentage as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,sm.ai_score as ai_success_score ,sm.student_id as student_id,sm.follow_up as follow_up,sm.recruiter_email as recruiter_email,sm.recruiter_followup_date as follow_up_date,concat(cast(round(sa.total_percentage,2) as decimal(10,2)),'%') as total_rc_score,sm.mobile_no as mobile_no,sm.university_name as college_name,sm.graduation_percentage as percentage,sm.graduation_name as graduation_name,sif.schlolarship as scholarship, sif.progress_percentage as progress_percentage,coalesce((select sm.ai_score), null ,'In Progress') as ai_score,sa.created_date as created_date,DATE_FORMAT(sa.created_date,\"%d/%m/%Y\") as date,sif.status as status,concat(round(((sa.correct_questions/sa.total_no_of_questions)*100+sa.total_coding_score)/2,2)) as score_percent,concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2),'%') AS rc_score,concat(sm.first_name,\" \",sm.last_name) as name From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sm.organization_id=:organizationId and sm.job_portal_id =:job_portal_id and sm.follow_up=1 and sm.recruiter_email=:email)order by sm.student_id desc")
    public List<LinkedCaseInsensitiveMap> getFollowUpStdnts(@Param("organizationId") Long organizationId, @Param("email") String email, @Param("job_portal_id") Long job_portal_id);

    @Query(nativeQuery = true, value = "SELECT distinct sm.job_portal_id as job_portal_id,jp.created_date as created,jp.job_portal_title as job_title, jp.experience as experience from student_master sm,student_interview_feed_back sif ,job_portal jp WHere sm.job_portal_id=jp.job_portal_id and sm.organization_id=:organizationId and sif.student_feedback_id=(select student_feedback_id from student_interview_feed_back where student_id=sm.student_id order by student_feedback_id desc limit 0,1)  and sif.status NOT IN(\"\") Order By jp.created_date DESC")
    public List<LinkedCaseInsensitiveMap> getJobProfile(@Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT sm.student_id as student_id, sa.mcq_percentage as mcq_percentage,sa.coding_percentage as coding_percentage, sa.ai_score as ai_score, sif.total_percentage1 as total_percentage1,sif.total_percentage2 as total_percentage2,sif.total_percentage3 as total_percentage3 FROM student_master sm INNER JOIN student_assessment sa on sa.student_id = sm.student_id INNER JOIN student_interview_feed_back sif where (sif.student_id=sm.student_id) and (sm.organization_id=?2) and (sm.job_portal_id = ?1) and (sif.status NOT IN('Assessment Completed'))")
    public List<LinkedCaseInsensitiveMap> allScoresByJobIdAndorganizationId(@Param("job_portal_id") Long jobPortalId, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT distinct sm.job_portal_id as job_portal_id ,jp.job_portal_title as job_title from student_master sm,student_interview_feed_back sif ,job_portal jp WHere sm.job_portal_id=jp.job_portal_id and (sm.organization_id=:organizationId) and sif.student_feedback_id=(select student_feedback_id from student_interview_feed_back where student_id=sm.student_id order by student_feedback_id desc limit 0,1)  and (sif.status =:stage or sif.stage2=:stage)")
    public List<LinkedCaseInsensitiveMap> getJobProfileForInterviewer2(@Param("organizationId") Long organizationId, @Param("stage") String stage);

    @Query(nativeQuery = true, value = "SELECT count( sif.student_id) FROM student_master sm inner join student_interview_feed_back sif where (sif.status='Selected' or sif.status='Rejected') and (sif.student_id=sm.student_id) and(sif.organization_id=:organizationId) and(sm.job_portal_id=:job_portal_id)")
    public int selectedRejectedCountByJobId(@Param("job_portal_id") Long jobPortalId, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT count(sif.student_id) FROM student_master sm inner join student_interview_feed_back sif where (sif.status='Selected' or sif.status='Rejected') and (sif.last_modified_date>=:startDate and sif.last_modified_date<=:endDate) and(sif.student_id=sm.student_id) and(sif.organization_id=:organizationId) and(sm.job_portal_id=:job_portal_id)")
    public int selectedRejectedCountADayByJobId(@Param("job_portal_id") Long jobPortalId, @Param("organizationId") Long organizationId, @Param("startDate") Date utilDate1, @Param("endDate") Date utilDate2);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:stage) order by sif.student_feedback_id desc  limit 0,1) where sm.job_portal_id=:jobId")
    public int statusWiseCountSearch(@Param("jobId") Long jobId, @Param("stage") String stage);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:stage or sif.stage2=:stage or sif.stage1=:stage) and (sif.last_modified_date>=:startDate and sif.last_modified_date<=:endDate) order by sif.student_feedback_id desc  limit 0,1) where sm.job_portal_id=:jobId")
    public int oneDayStatusWiseCountSearch(@Param("jobId") Long jobId, @Param("stage") String stage, @Param("startDate") Date startDate, @Param("endDate") Date endDate);

    @Query(nativeQuery = true, value = "select concat(round(sum(sif.total_percentage1)/sum(case when sif.total_percentage1 > 0 then 1 else 0 end ),2)) As avg_stage1_score,min(sif.total_percentage1) as min_stage1_score,max(sif.total_percentage1) As max_stage1_score,concat(round(sum(sif.total_percentage2)/sum(case when sif.total_percentage2 > 0 then 1 else 0 end ))) As avg_stage2_score,min(sif.total_percentage2) As min_stage2_score,max(sif.total_percentage2) As max_stage2_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and (sa.created_date>=:startDate1 and sa.created_date<=:endDate1) and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id)  order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and lower(sm.university_name)=lower(:collegeName) order by sa.created_date desc")
    public LinkedCaseInsensitiveMap allStagesScoreByClgName(@Param("collegeName") String collegeName, @Param("startDate1") Date startDate, @Param("endDate1") Date endDate);

    @Query(nativeQuery = true, value = "select distinct concat(round((sum(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))))/sum(case when ( sa.correct_questions/sa.total_no_of_questions * 100 ) > 0 then 1 else 0 end ),2)) AS avg_rc_score,min(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))) As min_rc_score,max(concat(round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2))) As max_rc_score,concat(round(sum(sm.ai_score)/sum(case when sm.ai_score > 0 then 1 else 0 end ),2)) as avg_ai_score,min(sm.ai_score) as min_ai_score,max(sm.ai_score) As max_ai_score,concat(round(sum(sa.coding_percentage)/sum(case when sa.coding_percentage > 0 then 1 else 0 end ),2)) As avg_coding_score,min(sa.coding_percentage) As min_coding_score, max(sa.coding_percentage) as max_coding_score From student_master sm, student_interview_feed_back as sif,student_assessment as sa , candidate_master as cm where  sm.student_id=sa.student_id and sm.organization_id=:organizationId and  sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.email_id IN(select distinct email from candidate_master where sender=:email) order by sa.created_date desc")
    public LinkedCaseInsensitiveMap allStdntsScoresForRec(@Param("email") String email, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT bm.badge_id as badge_id,bm.badge_name as badge_name, bm.badge_desc as badge_desc,bm.badge_type as badge_type,bm.url as url FROM student_badge_mapping sbm JOIN badge_master bm ON bm.badge_id=sbm.badge_id where sbm.student_id=:studentId")
    public List<LinkedCaseInsensitiveMap> studentBadges(@Param("studentId") Long student_id);

//    @Query(nativeQuery = true, value = "SELECT sm.student_id as student_id,sa.correct_questions as correct_questions,floor((sa.correct_questions/sa.total_no_of_questions) * 100) as percentage from student_master sm inner join student_assessment sa on sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id limit 0,1) left join users u on u.email=sm.email_id order By percentage desc")
//    public List<LinkedCaseInsensitiveMap> studentsMcqRank();
//    @Query(nativeQuery = true, value = "select sm.student_id as student_id,sa.coding_percentage as coding_percentage from student_master sm, student_assessment sa , users u where sa.student_id=sm.student_id and sa.student_assessment_id =(select sa.student_assessment_id from student_assessment sa where sa.student_id IN(sm.student_id) order by sa.student_assessment_id desc limit 0,1) and u.email=sm.email_id order by coding_percentage desc")
//    public List<LinkedCaseInsensitiveMap> studentsCodingRank();
    @Modifying
    @Transactional
    @Query("UPDATE StudentMaster sm SET sm.candStageMsg1Date=:date, sm.email_notification=:student_msg where sm.student_id=:student_id")
    public void updateStudentNotification(@Param("student_msg") String student_msg, @Param("student_id") Long student_id, @DateTimeFormat(pattern = "yyyy/MM/dd HH:mm:ss") @Param("date") Date currDate);

    @Query(nativeQuery = true, value = "select sad.question_id as question_id from student_assessment_details sad where sad.student_assessment_id=:studentAssessmentId ")
    public List<LinkedCaseInsensitiveMap> totalQuestionsIds(@Param("studentAssessmentId") Long studentAssessmentId);

    @Query(nativeQuery = true, value = "SELECT count(*) from student_master sm INNER JOIN student_assessment sa ON sa.student_assessment_id=(SELECT sa.student_assessment_id FROM student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc  limit 0,1) INNER JOIN student_interview_feed_back sif ON sif.student_feedback_id=(Select sif.student_feedback_id FROM student_interview_feed_back sif where sif.student_id=sm.student_id and (sif.status=:stage or sif.stage1=:stage or sif.stage2=:stage) order by sif.student_feedback_id desc  limit 0,1) where sm.job_portal_id=:jobId")
    public int intv2TotalPending(@Param("jobId") Long jobId, @Param("stage") String stage);

    @Query(nativeQuery = true, value = "select distinct lm.language_name as language_name, rc.rcassessment_id as rcassessment_id,rc.rcassessment_desc as rcassessment_desc FROM rcassessment_creation rc,student_assessment sa,language_master lm,student_master sm where rc.language_id=lm.language_id and sa.student_assessment_id =(select sa.student_assessment_id from student_assessment sa WHERE sa.assessment_id=rc.rcassessment_id order by sa.created_date desc limit 0,1) and (sm.job_portal_id=rc.job_portal_id) and (rc.active='Y' and rc.organization_id=:organizationId)")
    public List<LinkedCaseInsensitiveMap> activeAssessmentId(@Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select sa.student_id as student_id from student_master sm inner join student_assessment sa on sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id and sa.assessment_id=:assessmentId and sm.organization_id=:organizationId order by sa.student_assessment_id desc limit 0,1)")
    public List<LinkedCaseInsensitiveMap> getStntByAssessmentId(@Param("assessmentId") Long assessmentId, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select coalesce((qom.is_active),null,'N') as ques_anwer,sa.student_assessment_id as student_assessment_id,sa.student_id as student_id,sad.question_id as question_id,sad.answer as answer from  student_assessment sa inner join student_master sm on sa.student_id=sm.student_id inner join student_assessment_details sad on sad.student_assessment_id=sa.student_assessment_id left join question_option_mapping qom on qom.question_id=sad.question_id and qom.option_id=sad.answer where sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=:student_id and sa.assessment_id=:assessmentId and sm.organization_id=:organizationId order by sa.student_assessment_id desc limit 0,1)")
    public List<LinkedCaseInsensitiveMap> getStudentAnwersByAssessmentId(@Param("student_id") Long student_id, @Param("assessmentId") Long assessmentId, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT lm.language_name as language_name,qm.question_desc as question_desc,qt.question_type_name as question_type From question_master qm inner join language_master lm on lm.language_id=qm.language_id  inner join question_type qt on qt.question_type_id=qm.question_type_id  where qm.question_id=:question_id and qm.organization_id=:organizationId")
    public LinkedCaseInsensitiveMap getQuestionDesc(@Param("question_id") Long question_id, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select distinct sm.student_id ,sm.first_name as first_name,sm.profile_path as image_url ,sm.last_name as last_name,sa.correct_questions as correct_questions,concat(round(((sa.correct_questions/sa.total_no_of_questions) * 100 ))) as percentage From student_master sm, student_interview_feed_back as sif,student_assessment as sa, candidate_master as cm , users u where  sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.email_id IN(select distinct email from candidate_master where sender=:email) and u.email=sm.email_id and sm.job_portal_id=:jobId order by percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> recAssLeaders(@Param("email") String email, @Param("jobId") Long jobId);

    @Query(nativeQuery = true, value = "select distinct sm.email_id ,sif.status as stage, sm.student_id as student_id,sm.first_name as first_name, sm.last_name as last_name , sa.coding_percentage as coding_percentage,sm.profile_path as image_url From student_master sm, student_interview_feed_back as sif,student_assessment as sa, candidate_master as cm , users u where  sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.email_id IN(select distinct email from candidate_master where sender=:email) and u.email=sm.email_id and sm.job_portal_id=:jobId order by coding_percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> recTopCoders(@Param("email") String email, @Param("jobId") Long jobId);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm where sm.job_portal_id=:jobId")
    public int recManTotalStudents(@Param("jobId") Long jobId);

    @Query(nativeQuery = true, value = "SELECT count(*) FROM student_master sm where (sm.created_date>=:startDate and sm.created_date<=:endDate) and sm.job_portal_id=:jobId")
    public int recManDayOneStudents(@Param("jobId") Long jobId, @Param("startDate") Date startDate, @Param("endDate") Date endDate);

    @Query(nativeQuery = true, value = "select distinct sm.student_id ,sm.first_name as first_name,sm.profile_path as image_url ,sm.last_name as last_name,sa.correct_questions as correct_questions,concat(round(((sa.correct_questions/sa.total_no_of_questions) * 100 ))) as percentage From student_master sm, student_interview_feed_back as sif,student_assessment as sa, users u where  sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)  and u.email=sm.email_id and sm.job_portal_id=:jobId order by percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> recManAssLeadersByClg(@Param("jobId") Long jobId);

    @Query(nativeQuery = true, value = "select distinct sm.email_id ,sif.status as stage, sm.student_id as student_id,sm.first_name as first_name, sm.last_name as last_name , sa.coding_percentage as coding_percentage,sm.profile_path as image_url From student_master sm, student_interview_feed_back as sif,student_assessment as sa, users u where  sm.student_id=sa.student_id and sif.student_feedback_id =(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)  and u.email=sm.email_id and sm.job_portal_id=:jobId order by coding_percentage desc limit 0,3")
    public List<LinkedCaseInsensitiveMap> recManTopCodersByClg(@Param("jobId") Long jobId);

    @Query(nativeQuery = true, value = "select distinct sm.job_portal_id as job_portal_id,jp.created_date as created,jp.job_portal_title as job_title, jp.experience as experience from candidate_master cm,student_master sm,job_portal jp where (cm.email=sm.email_id and cm.sender=?2) and (sm.organization_id=?1) and (jp.job_portal_id=sm.job_portal_id) ORDER BY jp.created_date DESC")
    public List<LinkedCaseInsensitiveMap> getJobProfileForRecruiter(@Param("organizationId") Long organizationId, @Param("email") String email);

    @Query(nativeQuery = true, value = "SELECT distinct sm.job_portal_id as id ,jp.job_portal_title as jobPortalTitle, jp.experience as experience from student_master sm,student_interview_feed_back sif ,job_portal jp WHere sm.job_portal_id=jp.job_portal_id and  sm.organization_id=:organizationId and (sm.job_portal_id IN(:jobPortalIds))")
    public List<LinkedCaseInsensitiveMap> getJobProfileForSideNavbar(@Param("organizationId") Long organizationId, @Param("jobPortalIds") List<Long> jobPortalIds);

    @Query(nativeQuery = true, value = "SELECT distinct sm.job_portal_id as id ,jp.job_portal_title as jobPortalTitle, jp.experience as experience from student_master sm,student_interview_feed_back sif ,job_portal jp WHere sm.job_portal_id=jp.job_portal_id and sm.organization_id=:organizationId and sif.student_feedback_id=(select student_feedback_id from student_interview_feed_back where student_id=sm.student_id order by student_feedback_id desc limit 0,1)")
    public List<LinkedCaseInsensitiveMap> getJobProfileForSideNavbar(@Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT distinct job_portal_id FROM assign_interview WHERE lower(interviewer_email)=lower(:email)")
    public List<Long> getAssociatedJobProfile(@Param("email") String email);

//  @Query(nativeQuery = true, value = "select distinct jp.job_portal_title from job_portal jp Where jp.job_portal_id IN(:jobPortalIds)")
    @Query(nativeQuery = true, value = "select distinct  jp.job_portal_title as job_title,jp.created_date as created,jp.job_portal_id as job_portal_id, jp.experience as experience from student_master sm , job_portal jp ,student_assessment sa WHERE  sm.job_portal_id IN(:jobPortalIds) and (sm.job_portal_id = jp.job_portal_id)  and(sm.organization_id=:organizationId) and(sa.student_assessment_id =(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc limit 0,1)) ORDER BY jp.created_date DESC")
    public List<LinkedCaseInsensitiveMap> jobProfilesForInterviewers(@Param("jobPortalIds") List<Long> jobPortalIds, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "Select count(*) from assign_interview WHERE job_portal_id=:job_portal_id AND interviewer_email=:email AND no_of_round=:no_of_rounds")
    public Integer checkAssignInterview(@Param("job_portal_id") Long job_portal_id, @Param("email") String email, @Param("no_of_rounds") Long no_of_rounds);

    @Query(nativeQuery = true, value = "select distinct  jp.job_portal_title as job_title,jp.job_portal_id as job_portal_id from student_master sm , job_portal jp ,student_assessment sa WHERE   (sm.job_portal_id = jp.job_portal_id)  and(sm.organization_id=:organizationId) and(sa.student_assessment_id =(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc limit 0,1))")
    public List<LinkedCaseInsensitiveMap> getJobProfileForRecmag(@Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT categories From job_profile_categories WHERE job_portal_id=:jobPortalId AND organization_id=:organizationId")
    public List<LinkedCaseInsensitiveMap> jobProfileCategories(@Param("jobPortalId") Long jobPortalId, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select sp.success_id as success_id ,sp.ai_prediction as ai_prediction,sp.coding_prediction as coding_prediction, sp.mcq_prediction as mcq_prediction, sp.interview1_prediction as interview1_prediction, sp.interview2_prediction as interview2_prediction FROM success_prediction sp WHERE sp.active='Y' and sp.organization_id=:organizationId order by sp.success_id desc limit 0,1")
    public LinkedCaseInsensitiveMap getSuccessPredictionScore(@Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "Select cs.snapshot_url as snapUrl from camera_snapshot cs where organization_id=?1 and job_portal_id=?2 and student_id=?3 ")
    public List<LinkedCaseInsensitiveMap> getCameraSnapshots(Long orgId, Long jobId, Long studentId);

//    @Query(nativeQuery = true, value = "select distinct concat(sm.first_name,\" \",sm.last_name) as name,sm.created_date as date,sm.email_id as email,round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2) AS rc_score,sif.status as status,sm.profile_path as image_url,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId  and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and (sif.status ='Assessment Completed')and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)order by sm.created_date desc limit 0,5")
//    @Query(nativeQuery = true, value = "select distinct concat(sm.first_name,\" \",sm.last_name) as name,sm.created_date as date,sm.email_id as email,round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2) AS rc_score,sif.status as status,sm.profile_path as image_url,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id From student_master sm, student_interview_feed_back as sif,candidate_master cm,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId and cm.candidate_id =(select cm.candidate_id from candidate_master cm WHERE cm.sender=:email and cm.email=sm.email_id order by candidate_id desc limit 0,1) and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and (sif.status ='Assessment Completed')and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)  and  sm.job_portal_id=:job_portal_id order by sm.created_date desc limit 0,5")
//    public List<LinkedCaseInsensitiveMap> getAssCompletedStdnts(@Param("organizationId") Long organizationId, @Param("email") String email, @Param("job_portal_id") Long job_portal_id);
    @Query(nativeQuery = true, value = "select distinct concat(sm.first_name,\" \",sm.last_name) as name,sm.created_date as date,sm.email_id as email,round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2) AS rc_score,sif.status as status,sm.profile_path as image_url,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id From student_master sm, calender c , student_interview_feed_back as sif,candidate_master cm,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId and cm.candidate_id =(select cm.candidate_id from candidate_master cm WHERE cm.sender=:email and cm.email=sm.email_id order by candidate_id desc limit 0,1) and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and   c.id =(select c.id from calender c Where c.candidate_email != sm.email_id order by c.created_date desc limit 0,1) and     (sif.status ='Assessment Completed')and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)  and  sm.job_portal_id=:job_portal_id order by sm.created_date desc limit 0,5")
    public List<LinkedCaseInsensitiveMap> getAssCompletedStdnts(@Param("organizationId") Long organizationId, @Param("email") String email, @Param("job_portal_id") Long job_portal_id);

//    @Query(nativeQuery = true, value = "select distinct concat(sm.first_name,\" \",sm.last_name) as name,sm.mobile_no as mobile_no,sm.recruiter_followup_date as follow_up_date,round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2) AS rc_score,sif.status as status,sm.profile_path as image_url, round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id   and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and sm.organization_id=:organizationId and sm.follow_up =1 order by sm.recruiter_followup_date desc limit 0,5")
    @Query(nativeQuery = true, value = "select distinct concat(sm.first_name,\" \",sm.last_name) as name,sm.mobile_no as mobile_no,sm.recruiter_followup_date as follow_up_date,round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2) AS rc_score,sif.status as status,sm.profile_path as image_url, round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id From student_master sm,candidate_master cm  ,student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id   and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and cm.candidate_id =(select cm.candidate_id from candidate_master cm WHERE (cm.sender=:email and cm.email=sm.email_id) order by cm.candidate_id desc limit 0,1) and (sm.organization_id=:organizationId) and (sm.follow_up =1) and(sm.job_portal_id=:job_portal_id) order by sm.recruiter_followup_date desc limit 0,5")
    public List<LinkedCaseInsensitiveMap> getTopFollwedCandidates(@Param("organizationId") Long organizationId, @Param("email") String email, @Param("job_portal_id") Long job_portal_id);

//    @Query(nativeQuery = true, value = "SELECT distinct  c.candidate_email ,c.start_date as start_date,concat(sm.first_name,\" \",sm.last_name) as name , c.end_date as end_date, c.inter_sched_msg as scheduled_msg,c.interviewer_email as interviewer_email,sm.profile_path as image_url ,c.created_date as scheduled_date from student_master sm , calender c Where sm.email_id= c.candidate_email and c.id =(select c.id from calender c Where c.candidate_email =sm.email_id order by c.created_date desc limit 0,1) and sm.organization_id=:organizationId order by c.created_date desc limit 0,5")
    @Query(nativeQuery = true, value = "SELECT distinct  c.candidate_email ,c.start_date as start_date,concat(sm.first_name,\" \",sm.last_name) as name , c.end_date as end_date, c.inter_sched_msg as scheduled_msg,c.interviewer_email as interviewer_email,sm.profile_path as image_url ,c.created_date as scheduled_date from student_master sm ,candidate_master cm, calender c Where sm.email_id= c.candidate_email and c.id =(select c.id from calender c Where c.candidate_email =sm.email_id order by c.created_date desc limit 0,1) and cm.candidate_id=(select cm.candidate_id from candidate_master WHERE (cm.sender=:email and cm.email=sm.email_id ) order by cm.candidate_id desc limit 0,1) and sm.job_portal_id=:job_portal_id and  sm.organization_id=:organizationId order by c.created_date desc limit 0,5")
    public List<LinkedCaseInsensitiveMap> getInterviewScheduledStudents(@Param("organizationId") Long organizationId, @Param("email") String email, @Param("job_portal_id") Long job_portal_id);

//    @Query(nativeQuery = true, value = "select distinct concat(sm.first_name,\" \",sm.last_name) as name,sm.created_date as date,sm.email_id as email,round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2) AS rc_score,sif.status as status,sm.profile_path as image_url,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id From student_master sm, student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and (sif.status ='Assessment Completed')and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sm.job_portal_id=:job_portal_id) order by sm.created_date desc limit 0,5")
//    public List<LinkedCaseInsensitiveMap> getAssCompletedStdntsForRecMan(@Param("organizationId") Long organizationId, @Param("job_portal_id") Long job_portal_id);
    @Query(nativeQuery = true, value = "select distinct concat(sm.first_name,\" \",sm.last_name) as name,sm.created_date as date,sm.email_id as email,round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2) AS rc_score,sif.status as status,sm.profile_path as image_url,round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id From student_master sm, calender c , student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id and sm.organization_id=:organizationId and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and  c.id =(select c.id from calender c Where c.candidate_email != sm.email_id order by c.created_date desc limit 0,1) and    (sif.status ='Assessment Completed')and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1) and (sm.job_portal_id=:job_portal_id) order by sm.created_date desc limit 0,5")
    public List<LinkedCaseInsensitiveMap> getAssCompletedStdntsForRecMan(@Param("organizationId") Long organizationId, @Param("job_portal_id") Long job_portal_id);

    @Query(nativeQuery = true, value = "select distinct concat(sm.first_name,\" \",sm.last_name) as name,sm.mobile_no as mobile_no,sm.recruiter_followup_date as follow_up_date,round(( sa.correct_questions/sa.total_no_of_questions * 100 ),2) AS rc_score,sif.status as status,sm.profile_path as image_url, round(sif.total_percentage1 ,2) as interview1_score,round(sif.total_percentage2,2) as interview2_score,round(sa.coding_percentage,2) as coding_score,round(( (sa.correct_questions/sa.total_no_of_questions) * 100 ),2) as mcq_score,round(sm.ai_score,2) as ai_success_score ,sm.student_id as student_id From student_master sm,student_interview_feed_back as sif,student_assessment as sa where sm.student_id=sa.student_id  and sif.student_feedback_id =(select student_feedback_id from student_interview_feed_back where student_id IN (sm.student_id) order by student_feedback_id desc limit 1) and sa.student_assessment_id =(select student_assessment_id from student_assessment where student_id IN(sm.student_id) order by student_assessment_id desc limit 1)  and (sm.organization_id=:organizationId) and (sm.follow_up =1) and(sm.job_portal_id=:job_portal_id) order by sm.recruiter_followup_date desc limit 0,5")
    public List<LinkedCaseInsensitiveMap> getTopFollwedCandidatesForRecMan(@Param("organizationId") Long organizationId, @Param("job_portal_id") Long job_portal_id);

    @Query(nativeQuery = true, value = "SELECT distinct  c.candidate_email ,c.start_date as start_date,concat(sm.first_name,\" \",sm.last_name) as name , c.end_date as end_date, c.inter_sched_msg as scheduled_msg,c.interviewer_email as interviewer_email,sm.profile_path as image_url ,c.created_date as scheduled_date from student_master sm , calender c Where sm.email_id= c.candidate_email and c.id =(select c.id from calender c Where c.candidate_email =sm.email_id order by c.created_date desc limit 0,1)  and sm.job_portal_id=:job_portal_id and  sm.organization_id=:organizationId order by c.created_date desc limit 0,5")
    public List<LinkedCaseInsensitiveMap> getInterviewScheduledStudentsForRecMan(@Param("organizationId") Long organizationId, @Param("job_portal_id") Long job_portal_id);

    @Query(nativeQuery = true, value = "select aw.interviewer_email as email from student_master sm inner join assign_interview aw on aw.assign_id =(select aw.assign_id from assign_interview aw where (aw.job_portal_id =sm.job_portal_id and aw.organization_id =sm.organization_id) order by aw.assign_id desc limit 0,1) Where (sm.student_id=:student_id)")
    public LinkedCaseInsensitiveMap checkJobProfileMapped(@Param("student_id") Long student_id);

    @Query(nativeQuery = true, value = "Select DATE_FORMAT(cm.test_start_date,\"%d/%m/%Y\") as date from candidate_master cm Where lower(email)=lower(:email) order by cm.candidate_id desc limit 0,1")
    public LinkedCaseInsensitiveMap getAssessmentdate(@Param("email") String email);

    @Query(nativeQuery = true, value = "select distinct ( jp.job_portal_id) as id, jp.job_portal_title as jobPortalTitle, jp.experience as experience from candidate_master cm inner join student_validate sv on (sv.code=cm.test_code and sv.email=cm.email) inner join student_master sm on (sm.email_id=cm.email and sm.organization_id = 1) inner join job_portal jp on jp.job_portal_id=sm.job_portal_id where cm.sender = :email and cm.organization_id=:organizationId")
    public List<LinkedCaseInsensitiveMap> allJobOpeningsforRecruiter(@Param("email") String email, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select distinct jp.job_portal_id as id, jp.job_portal_title as jobPortalTitle, jp.experience as experience, ai.no_of_round from job_portal jp, assign_interview ai where jp.job_portal_id = ai.job_portal_id and ai.interviewer_email = :email and jp.organization_id = ai.organization_id and ai.organization_id=:organizationId")
    public List<LinkedCaseInsensitiveMap> allJobOpeningsforInterviewer(@Param("email") String email, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select distinct  jp.experience as experience, jp.job_portal_id as id, jp.job_portal_title as jobPortalTitle, ai.no_of_round from job_portal jp inner join assign_interview ai on ai.job_portal_id=jp.job_portal_id where jp.organization_id=:organizationId")
    public List<LinkedCaseInsensitiveMap> allInterviewerJobVisible(@Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select distinct ( jp.job_portal_id) as id, jp.job_portal_title as jobPortalTitle, jp.experience as experience from candidate_master cm inner join student_validate sv on (sv.code=cm.test_code and sv.email=cm.email) inner join student_master sm on (sm.email_id=cm.email and sm.organization_id = 1) inner join job_portal jp on jp.job_portal_id=sm.job_portal_id where cm.organization_id=:organizationId")
    public List<LinkedCaseInsensitiveMap> allRecruiterJobVisible(@Param("organizationId") Long organizationId);

    // Change by Arvind
//    @Query(nativeQuery = true, value = "SELECT sm.mobile_no as mobile_no,sm.profile_path as image_url,sm.email_id as email_id, concat(sm.first_name,\" \",sm.last_name) as name,jp.job_portal_title as job_portal_title,sm.job_portal_id as job_portal_id,sif.status as status,sif.selected_stage1 as selected_stage1,sm.student_id as student_id ,sif.last_modified_date as last_modified_date,sif.created_date as created_date FROM student_master sm INNER JOIN job_portal jp INNER JOIN student_interview_feed_back sif where (sif.student_id=sm.student_id) and (sif.organization_id=?2) and (jp.job_portal_id = sm.job_portal_id) and(sm.job_portal_id IN (?1)) and(sif.status NOT IN('Assessment Completed'))")
    @Query(nativeQuery = true, value = "SELECT distinct email_id as email_id, stage1 as stage1 ,stage2 as stage2 ,stage3 as stage3 , sm.mobile_no as mobile_no,sm.profile_path as image_url, concat(sm.first_name,\" \",sm.last_name) as name,jp.job_portal_title as job_portal_title,sm.job_portal_id as job_portal_id,sif.status as status,sif.selected_stage1 as selected_stage1,sm.student_id as student_id ,sif.last_modified_date as last_modified_date,sif.created_date as created_date FROM student_master sm INNER JOIN job_portal jp INNER JOIN student_interview_feed_back sif on sif.student_feedback_id=(select sif.student_feedback_id from student_interview_feed_back sif Where sif.student_id=sm.student_id order by sif.student_feedback_id desc limit 0,1) and (sif.organization_id=:organizationId) and (jp.job_portal_id = sm.job_portal_id) and(sm.job_portal_id IN (:jobPortalId )) and(sif.status NOT IN('Assessment Completed')) inner join assign_interview ai on ai.job_portal_id=jp.job_portal_id  and ai.no_of_round in (:no_of_round) and ai.organization_id=:organizationId and ai.interviewer_email=:email")
    public List<LinkedCaseInsensitiveMap> getAllIntvCand(List<Long> no_of_round, Long jobPortalId, Long organizationId, String email);

    @Query(nativeQuery = true, value = "SELECT sm.first_name as first_name, sm.job_portal_id as job_portal_id , sm.student_id as student_id ,sm.last_name as last_name,sm.profile_path as image_url,sa.mcq_percentage as percentage,sa.coding_percentage as coding_percentage from student_master sm ,student_assessment sa,student_interview_feed_back sif where sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc limit 0,1) and sif.student_feedback_id=(select student_feedback_id from student_interview_feed_back where student_id=sm.student_id order by student_feedback_id desc limit 0,1) and (sif.status NOT IN('Assessment Completed')) and (sm.organization_id=?2) and(sm.job_portal_id=?1)")
    public List<LinkedCaseInsensitiveMap> allTopersforInterviewer(Long jobPortalId, Long organizationId);

//    @Query(nativeQuery = true, value = "Select sm.mobile_no as mobile_no,sm.profile_path as image_url,sm.email_id as email_id, concat(sm.first_name,\" \",sm.last_name) as name,sm.job_portal_id as job_portal_id,jp.job_portal_title as job_portal_title, sm.student_id as student_id,sif.status as status,sif.selected_stage1 as yes ,sif.created_date as start_date , sif.last_modified_date as end_date from student_master sm  inner join job_portal jp on jp.job_portal_id=sm.job_portal_id inner join student_interview_feed_back sif on sif.student_id = sm.student_id Where (sm.job_portal_id=:jobId and sm.organization_id=:organizationId)")
    @Query(nativeQuery = true, value = "Select sm.mobile_no as mobile_no,sm.profile_path as image_url,sm.email_id as email_id, concat(sm.first_name,\" \",sm.last_name) as name,sm.job_portal_id as job_portal_id,jp.job_portal_title as job_portal_title, sm.student_id as student_id,sif.status as status,sif.selected_stage1 as yes ,sif.created_date as start_date , sif.last_modified_date as end_date from student_master sm  inner join job_portal jp on jp.job_portal_id=sm.job_portal_id inner join student_interview_feed_back sif on sif.student_feedback_id=(select sif.student_feedback_id from student_interview_feed_back sif Where sif.student_id=sm.student_id order by sif.student_feedback_id desc limit 0,1) Where (sm.job_portal_id=:jobId and sm.organization_id=:organizationId)")
    public List<LinkedCaseInsensitiveMap> getTotalCandidatesData(@Param("jobId") Long jobId, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "SELECT sm.first_name as first_name,sm.student_id as student_id, sm.last_name as last_name,sm.profile_path as image_url,sa.mcq_percentage as percentage,sa.coding_percentage as coding_percentage from student_master sm ,student_assessment sa,student_interview_feed_back sif where sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where sa.student_id=sm.student_id order by sa.student_assessment_id desc limit 0,1) and sif.student_feedback_id=(select student_feedback_id from student_interview_feed_back where student_id=sm.student_id order by student_feedback_id desc limit 0,1)  and (sm.organization_id=:organizationId) and(sm.job_portal_id=:jobId)")
    public List<LinkedCaseInsensitiveMap> getAssLeaderAndTopCodersForRecMan(@Param("jobId") Long jobId, @Param("organizationId") Long organizationId);

//  @Query(nativeQuery = true, value = "SELECT sm.mobile_no as mobile_no,sm.profile_path as image_url,sm.email_id as email_id, concat(sm.first_name,\" \",sm.last_name) as name,sm.job_portal_id as job_portal_id,jp.job_portal_title as job_portal_title, sm.student_id as student_id,sif.status as status,sif.selected_stage1 as yes ,sif.created_date as start_date , sif.last_modified_date as end_date from student_master sm inner join candidate_master cm on (cm.sender=?2 and cm.email=sm.email_id) inner join student_interview_feed_back sif on sif.student_id=sm.student_id inner join job_portal jp on jp.job_portal_id=sm.job_portal_id where (sm.organization_id=?3 and sm.job_portal_id=?1)")
    @Query(nativeQuery = true, value = "SELECT sm.mobile_no as mobile_no,sm.profile_path as image_url,sm.email_id as email_id, concat(sm.first_name,\" \",sm.last_name) as name,sm.job_portal_id as job_portal_id,jp.job_portal_title as job_portal_title, sm.student_id as student_id,sif.status as status,sif.selected_stage1 as yes ,sif.created_date as start_date , sif.last_modified_date as end_date from student_master sm inner join candidate_master cm on cm.candidate_id=(select cm.candidate_id from candidate_master cm where (cm.sender=?2 and cm.email=sm.email_id) order by cm.candidate_id desc limit 0,1 )  inner join student_interview_feed_back sif on sif.student_feedback_id=(select sif.student_feedback_id from student_interview_feed_back sif Where sif.student_id=sm.student_id order by sif.student_feedback_id desc limit 0,1)  inner join job_portal jp on jp.job_portal_id=sm.job_portal_id where (sm.organization_id=?3 and sm.job_portal_id=?1)")
    public List<LinkedCaseInsensitiveMap> getAllCandForRec(Long jobPortalId, String email, Long organizationId);

    @Query(nativeQuery = true, value = "SELECT distinct (sm.student_id) as student_id, sa.mcq_percentage as mcq_percentage,sa.coding_percentage as coding_percentage, sa.ai_score as ai_score, sif.total_percentage1 as total_percentage1,sif.total_percentage2 as total_percentage2,sif.total_percentage3 as total_percentage3 FROM student_master sm INNER JOIN student_assessment sa on sa.student_id = sm.student_id INNER JOIN candidate_master cm on (cm.sender =?2 and cm.email=sm.email_id) INNER JOIN student_interview_feed_back sif where (sif.student_id=sm.student_id) and (sm.organization_id=?3) and (sm.job_portal_id =?1)")
    public List<LinkedCaseInsensitiveMap> getAllAvgsRec(Long jobPortalId, String email, Long organizationId);

    @Query(nativeQuery = true, value = "select sm.first_name as first_name ,sm.student_id as student_id, sm.last_name as last_name,sm.profile_path as image_url,sa.mcq_percentage as percentage,sa.coding_percentage as coding_percentage from student_master sm,student_assessment sa where sm.email_id IN (select distinct cm.email from candidate_master cm where cm.sender=?2 and cm.organization_id=?3) and sa.student_assessment_id=(select saa.student_assessment_id from student_assessment saa where saa.student_id=sm.student_id order by saa.student_assessment_id desc limit 0,1) and sm.job_portal_id=?1")
    public List<LinkedCaseInsensitiveMap> getAllLeaderRec(Long jobPortalId, String email, Long organizationId);

    @Query(nativeQuery = true, value = "Select jpc.categories as categories From student_master sm INNER JOIN job_profile_categories jpc on jpc.job_portal_id=sm.job_portal_id Where sm.student_id=:studentId")
    public List<LinkedCaseInsensitiveMap> getJobCategoriesByStntId(@Param("studentId") Long studentId);

    @Query(nativeQuery = true, value = "SELECT * from student_interview_feed_back sif Where sif.student_feedback_id=(select sif.student_feedback_id from student_interview_feed_back sif where sif.student_id=:studentId order by sif.student_feedback_id desc limit 0,1)")
    public LinkedCaseInsensitiveMap categoriedWiseScores(@Param("studentId") Long studentId);

    @Query(nativeQuery = true, value = "Select jp.interviews as rounds from student_master sm inner join job_portal jp on jp.job_portal_id=sm.job_portal_id Where sm.student_id =:studentId")
    public Long getInterviewRounds(@Param("studentId") Long studentId);

    @Query(nativeQuery = true, value = "Select sm.email_id as studentEmail , concat(sm.first_name,\" \",sm.last_name ) as name  from student_master sm where sm.student_id=:studentId")
    public LinkedCaseInsensitiveMap studentEmail(@Param("studentId") Long studentId);

    @Query(nativeQuery = true, value = "SELECT cm.sender as sender , cm.created_date as created_date from candidate_master cm inner join student_master sm on cm.email=sm.email_id where sm.student_id=:studentId order by cm.created_date  desc limit 1")
    public LinkedCaseInsensitiveMap senderEmailForStudent(@Param("studentId") Long studentId);

    // Arvind 
    @Query(nativeQuery = true, value = "select no_of_round   from assign_interview where job_portal_id=:job_portal_id and  lower(interviewer_email)=lower(:email) and organization_id=:organizationId")
    public List<Long> getAssociatedJobProfile1(@Param("job_portal_id") Long job_portal_id, @Param("organizationId") Long organizationId, @Param("email") String email);

    @Query(nativeQuery = true, value = "SELECT  status as status  FROM student_master sm INNER JOIN job_portal jp INNER JOIN student_interview_feed_back sif on sif.student_feedback_id=(select sif.student_feedback_id from student_interview_feed_back sif Where sif.student_id=sm.student_id order by sif.student_feedback_id desc limit 0,1) and (sif.organization_id=:organizationId) and (jp.job_portal_id = sm.job_portal_id) and(sm.job_portal_id IN (:jobPortalId )) and(sif.status NOT IN('Assessment Completed')) inner join assign_interview ai on ai.job_portal_id=jp.job_portal_id  and ai.organization_id=:organizationId and ai.interviewer_email=:email")
    public List<LinkedCaseInsensitiveMap> status(Long jobPortalId, Long organizationId, String email);

    @Query(nativeQuery = true, value = "SELECT status as status , progress_percentage as progress_percentage FROM student_interview_feed_back where student_id=:student_id and organization_id=:organizationId")
    public List<LinkedCaseInsensitiveMap> getStudentStaus(@Param("student_id") Long student_id, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "Select count(*) from right_master rm INNER JOIN organization_right_mapping orm on orm.right_id=rm.right_id Where rm.right_url=\"resumeparser\" and orm.organization_id=:organizationId")
    public Integer checkResumeRight(@Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select lm.language_name as topicName, qm.topic_id as topicId,qm.question_type_id as question_type_id,qt.question_type_desc as questionType from question_master qm INNER JOIN language_master lm ON lm.language_id=qm.language_id INNER JOIN question_type qt ON qt.question_type_id=qm.question_type_id where qm.question_id=:question_id")
    public List<LinkedCaseInsensitiveMap> findTnameAndQCount(@Param("question_id") Long qId);

    @Query(nativeQuery = true, value = "select lm.language_name as topicName,qt.question_type_id as questionTypeId,qm.question_id as questionId from question_master qm INNER JOIN language_master lm ON lm.language_id=qm.language_id INNER JOIN question_type qt ON qt.question_type_id=qm.question_type_id where qm.question_id=:question_id")
    public LinkedCaseInsensitiveMap findTopicName(@Param("question_id") Long qId);

    @Query(nativeQuery = true, value = "select count(aq.question_id) as topicCount from assessment_question aq , question_master qm,language_master lm where qm.question_id=aq.question_id and qm.language_id=lm.language_id and lm.language_name=:languageName and qm.question_type_id=1 and aq.assessment_id=:assessmentId")
    public Integer findTotalQuestion(@Param("assessmentId") Long assessmentId, @Param("languageName") String topicName);

    @Query("Select student_id  from StudentMaster where lower(email_id)=lower(:email_id) AND organizationId=:organizationId")
    public Long findByEmailAndOrgId(@Param("email_id") String email_id, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "select sm.first_name as first_name,sm.student_id as student_id, sm.last_name as last_name , sm.profile_path as imageUrl from student_master sm inner join student_assessment sa on sa.student_assessment_id=(select sa.student_assessment_id from student_assessment sa where (sa.student_id=sm.student_id and sa.assessment_id =:assessmentId and sa.direct_ass =1) order by sa.student_assessment_id desc limit 0,1) where sm.organization_id =:organizationId")
    public List<LinkedCaseInsensitiveMap> getCandidateByAssId(@Param("assessmentId") Long assessmentId, @Param("organizationId") Long organizationId);

    @Query(nativeQuery = true, value = "Select sa.assessment_id as assessment_id,qm.question_type_id as  question_type_id , (CASE When qom.option_desc is null then 'N' ELSE 'Y' END)  as answer, qm.question_id as question_id , tm.topic_name as topic_name from  student_assessment sa inner join  student_assessment_details sad on sad.student_assessment_id=sa.student_assessment_id left join question_master qm on qm.question_id=sad.question_id left join topic_master tm on tm.topic_id=qm.topic_id left join question_option_mapping qom on qom.option_id=sad.answer and qom.is_active='Y'  Where  sa.student_assessment_id=:student_assessment_id")
    public List<LinkedCaseInsensitiveMap> stdntQuestionStatus(@Param("student_assessment_id") Long student_assessment_id);

}
